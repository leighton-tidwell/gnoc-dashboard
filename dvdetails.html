<html>

<head>
  <title>GNOC DV Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.6.4/css/buttons.dataTables.min.css" />
  <link rel="stylesheet" href="./css/global.css" />

  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/js/bootstrap.bundle.min.js"></script>
  <script type="text/javascript"
    src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
  <script type="text/javascript" src="https://code.highcharts.com/highcharts.js"></script>
  <script type="text/javascript" src="https://code.highcharts.com/modules/exporting.js"></script>
  <script type="text/javascript" src="https://code.highcharts.com/modules/export-data.js"></script>
  <script type="text/javascript" src="https://code.highcharts.com/modules/accessibility.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.6.4/js/dataTables.buttons.min.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.6.4/js/buttons.html5.min.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.6.4/js/buttons.print.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.5.0/jszip.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/pdfmake.min.js"></script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.4/moment.min.js"></script>
  <script type="text/javascript" src="//cdn.datatables.net/plug-ins/1.10.22/sorting/datetime-moment.js"></script>
  <script type="text/javascript" src="./js/user.js"></script>
  <script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script>
  <script>
    /* High Charts Configs */
    var yearDvOptions = {
      chart: {
        renderTo: 'dvYearlyGraph',
        type: 'line'
      },
      title: {
        text: 'Percentage of Legs without Issue',
        align: 'center',
      },
      legend: {
        align: 'right',
        verticalAlign: 'top'
      },
      xAxis: {
        categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
          'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
      },
      yAxis: {
        title: {
          text: ' Missions Per Month'
        },
      },
      series: []
    };

    var percentLegsIssues = {
      chart: {
        renderTo: 'percentLegsWithoutIssues',
        type: 'column',
      },
      title: {
        text: 'Percentage Missions Without Issues'
      },
      xAxis: {
        categories: [],
        labels: {
          style: {
            fontSize: '1.2em',
            color: '#000'
          }
        }
      },
      legend: { enabled: false },
      yAxis: {
        min: 0,
        max: 100,
        labels: {
          formatter: function () {
            return this.value + "%";
          }
        }
      },
      lang: {
        noData: "No Data Found"
      },
      noData: {
        style: {
          fontWeight: 'bold',
          fontSize: '15px',
          color: '#303030'
        }
      },
      colors: [
        '#4572A7',
        '#AA4643',
        '#89A54E',
        '#80699B',
        '#3D96AE',
        '#DB843D',
        '#92A8CD',
        '#A47D7C',
        '#B5CA92'
      ],
      plotOptions: {
        column: {
          dataLabels: {
            enabled: true,
            crop: false,
            overflow: 'none',
            formatter: function () {
              return this.y + "%";
            }
          },
        }
      },
      series: [],
      dataSorting: {
        enabled: true
      },
      credits: {
        enabled: false
      }
    };

    ticketsPerCategory = {
      chart: {
        renderTo: 'ticketsPerCategory',
        type: 'pie',
        events: {
          load: function (event) {
            var chart = this,
              points = chart.series[0].points,
              len = points.length,
              total = 0,
              i = 0;

            for (; i < len; i++) {
              total += points[i].y;
            }
            chart.setTitle({
              text: 'Total Tickets by Category:<br >' + total,
              align: 'center',
              verticalAlign: 'middle',
              y: 20,
              style: {
                fontWeight: 'bold'
              },
            });
          }
        },
        margin: [0, 0, 0, 0],
        spacingTop: 0,
        spacingBottom: 0,
        spacingLeft: 0,
        spacingRight: 0
      },
      tooltip: {
        formatter: function () {
          return '<b>' + this.point.name + '</b>: ' + this.y;
        }
      },
      legend: {
        enabled: true,
        floating: true,
        borderWidth: 0,
        align: 'center',
        layout: 'horizontal',
        verticalAlign: 'bottom',
        labelFormatter: function () {
          return '<span>' + this.name + ' </span>: <span><b>' + this.y + '</span>';
        }
      },
      yAxis: {
        title: {
          text: ''
        }
      },
      plotOptions: {
        pie: {
          shadow: false,
          size: '100%'
        }
      },
      series: [],
      colors: [
        '#4572A7',
        '#AA4643',
        '#89A54E',
        '#80699B',
        '#3D96AE',
        '#DB843D',
        '#92A8CD',
        '#A47D7C',
        '#B5CA92'
      ],
      credits: {
        enabled: false
      }
    };

    var ticketsPerTail = {
      chart: {
        renderTo: 'ticketsPerTail',
        type: 'bar'
      },
      title: {
        text: 'Tickets Per Tail (With DV Impact)'
      },
      xAxis: {
        categories: [],
        title: {
          text: 'Tail Number'
        }
      },
      yAxis: {
        min: 0,
        title: {
          text: 'Total Tickets'
        }
      },
      legend: {
        reversed: true
      },
      plotOptions: {
        series: {
          stacking: 'normal',
          dataLabels: {
            enabled: true,
            formatter: function () {
              if (this.y) {
                return this.y;
              }
            },
            style: {
            }
          }
        }
      },
      series: [],
      colors: [
        '#FF0000',
        '#FFA500',
        '#FFFF00',
        '#008000'
      ],
      credits: {
        enabled: false
      }
    }

    var issuesPerLeg = {
      chart: {
        renderTo: 'dvIssuesPerLeg',
        type: 'bar'
      },
      title: {
        text: 'Issues Per Leg'
      },
      xAxis: {
        categories: [],
        title: {
          text: 'Month'
        }
      },
      yAxis: {
        min: 0,
        title: {
          text: 'Total Tickets'
        }
      },
      legend: {
        reversed: true
      },
      plotOptions: {
        series: {
          stacking: 'normal',
          dataLabels: {
            enabled: true,
            formatter: function () {
              if (this.y) {
                return this.y;
              }
            },
            style: {
            }
          }
        }
      },
      series: [],
      colors: [
        '#FF0000',
        '#FFFF00',
        '#008000'
      ],
      credits: {
        enabled: false
      }
    }

    $(function () {
      // Check permissions of page:
      if (!checkPermissions("RFYgREVUQUlMUw==", false, true)) {
        $("html").remove();
      }

      // Permissions of content if page true and let page content run
      if (checkPermissions("RFYgREVUQUlMUw==", false, false)) {

        // nav
        checkPermissions("REFTSEJPQVJE", "dashboard_div", false);
        checkPermissions("RkxJR0hUIFNDSEVEVUxF", "flight_schedule_div", false);
        if (!checkPermissions("Q1JFQVRFIFRUUw==", "create_tts_div", false) && !checkPermissions("Q1JFQVRFIE1BU1RFUiBUVFM=", "create_master_tts_div", false) && !checkPermissions("VElDS0VUIFNFVFRJTkdT", "ticket_settings_div", false) && !checkPermissions("VklFVyBUSUNLRVRT", "view_tickets_div", false)) {
          $("#tickets_header_div").remove();
        }
        checkPermissions("Q1JFQVRFIFRUUw==", "create_tts_div", false);
        checkPermissions("Q1JFQVRFIE1BU1RFUiBUVFM=", "create_master_tts_div", false);
        checkPermissions("VElDS0VUIFNFVFRJTkdT", "ticket_settings_div", false);
        checkPermissions("VklFVyBUSUNLRVRT", "view_tickets_div", false);
        if (!checkPermissions("Q1JFQVRFIEZMSUdIVCBUSUNLRVQ=", "create_flight_ticket_div", false) && !checkPermissions("VklFVyBGTElHSFQgVElDS0VUUw==", "view_flight_tickets_div", false) && !checkPermissions("VklFVyBNSVNTSU9OUw==", "view_missions_div", false)) {
          $("#flight_tickets_header_div").remove();
        }
        checkPermissions("Q1JFQVRFIEZMSUdIVCBUSUNLRVQ=", "create_flight_ticket_div", false);
        checkPermissions("Q1JFQVRFIEZMSUdIVCBUSUNLRVQ=", "create_flight_ticket_icon_div", false);
        checkPermissions("VklFVyBGTElHSFQgVElDS0VUUw==", "view_flight_tickets_div", false);
        checkPermissions("VklFVyBNSVNTSU9OUw==", "view_missions_div", false);
        if (!checkPermissions("QUREIEEgQ0NJUg==", "add_a_ccir_div", false) && !checkPermissions("VklFVyBDQ0lSUw==", "view_ccirs_div", false)) {
          $("#ccir_header_div").remove();
        }
        checkPermissions("QUREIEEgQ0NJUg==", "add_a_ccir_div", false);
        checkPermissions("QUREIEEgQ0NJUg==", "add_a_ccir_icon_div", false);
        checkPermissions("VklFVyBDQ0lSUw==", "view_ccirs_div", false);
        if (!checkPermissions("MjQgSE9VUiBSRVBPUlQ=", "24_hour_report_div", false)) {
          $("#reports_header_div").remove();
        }
        checkPermissions("MjQgSE9VUiBSRVBPUlQ=", "24_hour_report_div", false);
        checkPermissions("Q09OVEFDVCBMSVNU", "contact_list_div", false);
        checkPermissions("V0VFS0VORCBUSUNLRVQgUkVQT1JU", "weekend_report_div", false);
        checkPermissions("TU9STklORyBTTElERVM=", "morning_slides_div", false);
        checkPermissions("UEVSU09OTkVMIFNUQVRT", "personnel_stats_div", false);
        checkPermissions("TUVUUklDUw==", "monthly_metrics_div", false);
        checkPermissions("UEVSTUlTU0lPTlM=", "permissions_div", false);


        $.fn.dataTable.moment('MM/DD/YYYY HH:mmZ');
        $('#dv_select_2').on('change', function () {
          // User has selected a DV on the dv page.
          var dvs = $('#dv_select_2').val();
          dvDetails(dvs);
        });

        // Change the start_date
        $('#start_date').change(function () {
          var startDate = $('#start_date').val() + "T00:00:00Z";
          var endDate = $('#end_date').val() + "T23:59:59Z";
          updateInformation(startDate, endDate);
        });

        $('#end_date').change(function () {
          var startDate = $('#start_date').val() + "T00:00:00Z";
          var endDate = $('#end_date').val() + "T23:59:59Z";
          updateInformation(startDate, endDate);
        });

        // Populate DV Drop down
        var urlLoad = "https://intelshare.intelink.gov/sites/89cs/GNOC/_api/web/lists/getbytitle('DVList')/items?$top=5000&$orderby=DV%20asc";
        $.ajax({
          url: urlLoad,
          async: false,
          method: "GET",
          headers: {
            "Accept": "application/json;odata=verbose"
          },
          success: function (data) {
            var total = 0;
            var allResults = data.d.results;
            if (Number(allResults.length) > 0) {
              var select = document.getElementById('dv_select_2');
              for (var i = 0; i < Number(allResults.length); i++) {
                // looping through all results
                var opt = document.createElement('option');
                opt.innerHTML = allResults[i].DV;
                select.appendChild(opt);
              }
              $('.selectpicker').selectpicker('refresh');
            }
          },
          error: function (data) {
            //alert("Error: " + JSON.stringify(data));
          }
        });
        /*var select = document.getElementById('dv_select_2');
        select.innerHTML = "<optgroup label=\"Top 5\"><option>VPOTUS</option><option>SECDEF</option><option>SECSTATE</option><option>CJCS</option></optgroup>";
        for (var i = 0; i < dvOptions.length; i++) {
            var opt = document.createElement('option');
            opt.innerHTML = dvOptions[i];
            select.appendChild(opt);
        }
        $('.selectpicker').selectpicker('refresh');*/

        // On page load, settings are blank.
      }
      feather.replace();
    });

    function convertTheDate(dateVar, offset) {
      // date conversion
      var convertDate = new Date(dateVar);
      var month = convertDate.getUTCMonth();
      month = ("0" + (convertDate.getMonth() + 1)).slice(-2)

      var date = convertDate.getDate();
      if (convertDate.getDate() < 10)
        date = "0" + convertDate.getDate();

      var minutes = convertDate.getUTCMinutes();
      if (convertDate.getUTCMinutes() < 10)
        minutes = "0" + convertDate.getUTCMinutes();

      var t = new Date();
      if (offset == 1) {
        var currentoffset = convertDate.getTimezoneOffset() * 60000;
        convertDate.setTime(convertDate.getTime() + currentoffset);
      }
      var hours = convertDate.getHours();

      if (convertDate.getHours() < 10)
        hours = "0" + hours;

      var dateString = month + "/" + date + "/" + convertDate.getUTCFullYear() + " " + hours + ":" + minutes + "Z";
      return dateString;
    }

    // Everything for DV Details Page:
    function dvDetails(dvs) {
      // all script for the dv_details page is here
      var now = new Date();
      year = now.getFullYear();
      var day = ("0" + now.getDate()).slice(-2);
      var month = ("0" + (now.getMonth() + 1)).slice(-2);

      var start_date = now.getFullYear() + "-" + (month) + "-01";
      var end_date = now.getFullYear() + "-" + (month) + "-" + (day);

      // Load date objects
      $('#start_date').val(start_date);
      $('#end_date').val(end_date);

      // Generate DataTable object
      if (!$.fn.DataTable.isDataTable('#dvOpenTickets')) {
        $('#dvOpenTickets').DataTable({
          dom: 'Bfrtip',
          buttons: [
            'copy', 'csv', 'excel', 'pdf', 'print'
          ],
          "columnDefs": [
            { "width": "140px", targets: [0] },
            { "width": "125px", targets: [1] },
            { "width": "300px", targets: [8] }
          ],
          "order": [[0, "desc"]]
        });
      }
      else {
        $('#dvOpenTickets').DataTable().clear().draw();
      }

      if ($('#dvYearlyGraph').highcharts()) {
        while (yearDvOptions.series.length > 0)
          yearDvOptions.series.pop();
      }


      var arrayOfUnsuccessfulMissions = [];
      var arrayOfSuccessfulMissions = [];
      var yearUnsuccessful = 0;
      var yearSuccessful = 0;
      // First lets pull ALL of the tickets TOTAL
      var urlLoad = "https://intelshare.intelink.gov/sites/89cs/GNOC/_api/web/lists/getbytitle('Tickets')/items?$select=DV,Created,GNOC_Ticket_Number,Date_Opened,Tail_Number,Mission_Number,DV_Impact,Impact_Level,Category,Status,Issue_Description,Last_Reported_Action,Update_Date,CCIR,CCIR_Number,CSO&$top=5000&$filter=DV eq '" + dvs + "'";
      $.ajax({
        url: urlLoad,
        async: false,
        method: "GET",
        headers: {
          "Accept": "application/json;odata=verbose"
        },
        success: function (data) {
          var total = 0;
          var arrayOfTimes = []; // times of tickets unique to mission number
          var countYearly = [];
          var allResults = data.d.results;
          if (Number(allResults.length) > 0) {

            for (var i = 0; i < Number(allResults.length); i++) {
              // looping through all results
              var currentTime = allResults[i].Created;
              var currentMission = allResults[i].Mission_Number;

              if (arrayOfTimes.includes(currentTime)) {
                // this is to make sure no duplicates are included.

              }
              else {
                // not a duplicate so continue on.

                // Dont care about when or where, just if its open - if open lets add to table.
                if (allResults[i].Status != "CLOSED" && allResults[i].Status != "Closed") {
                  var dateOpened = convertTheDate(allResults[i].Date_Opened, 1);
                  var dateUpdated = convertTheDate(allResults[i].Update_Date, 1);
                  var href = "<a href=\"./viewTicket.html?ticket=" + allResults[i].GNOC_Ticket_Number + "\">" + allResults[i].GNOC_Ticket_Number + "</a>";
                  if (checkPermissions("VklFVyBNSVNTSU9O", false, false)) {
                    var missionhref = "<a href=\"./viewMission.html?mission=" + allResults[i].Mission_Number + "\">" + allResults[i].Mission_Number + "</a>";
                  }
                  else {
                    var missionhref = allResults[i].Mission_Number;
                  }
                  $('#dvOpenTickets').DataTable().row.add([href, dateOpened, allResults[i].Tail_Number, missionhref, allResults[i].DV, allResults[i].Impact_Level, allResults[i].Category, allResults[i].Status, allResults[i].Issue_Description, allResults[i].Last_Reported_Action, dateUpdated]).draw();
                }
                if (!arrayOfUnsuccessfulMissions.includes(currentMission)) {
                  // no need to keep adding the same unsucessful mission in here.. just take 1 ticket from that mission - we can use this to check against missions database
                  arrayOfUnsuccessfulMissions.push(currentMission);
                  arrayOfTimes.push(currentTime);
                }
              }
            }

            // Now we need to loop, per month.
            for (var j = 1; j < 13; j++) {
              total = 0;
              if (j < 10) {
                var currentMonth = "0" + j;
              }
              else {
                var currentMonth = j;
              }

              var startDate = year + "-" + currentMonth + "-01";
              var endDate = year + "-" + currentMonth + "-31";

              for (var k = 0; k < arrayOfTimes.length; k++) {
                if (arrayOfTimes[k] <= endDate && arrayOfTimes[k] >= startDate) {
                  total++;
                }
              }
              countYearly.push(total);
            }
            yearDvOptions.series.push({
              name: "Unsuccessful Missions",
              data: countYearly
            });

            for (i = 0; i < countYearly.length; i++) {
              yearUnsuccessful = yearUnsuccessful + countYearly[i];
            }
          }
        },
        error: function (data) {
          //alert("Error: " + JSON.stringify(data));
        }
      });

      // Now lets poll all the missions for said DV and see what ones were successful.
      var urlLoad = "https://intelshare.intelink.gov/sites/89cs/GNOC/_api/web/lists/getbytitle('Missions')/items?$select=DV,Mission_Number,Departure_Date&$top=5000&$filter=DV eq '" + dvs + "'";
      $.ajax({
        url: urlLoad,
        async: false,
        method: "GET",
        headers: {
          "Accept": "application/json;odata=verbose"
        },
        success: function (data) {
          var total = 0;
          var arrayOfTimes = []; // times of tickets unique to mission number
          var countYearly = [];
          var allResults = data.d.results;
          if (Number(allResults.length) > 0) {

            for (var i = 0; i < Number(allResults.length); i++) {
              // looping through all results
              var currentTime = allResults[i].Departure_Date;
              var currentMission = allResults[i].Mission_Number;

              if (!arrayOfTimes.includes(currentTime)) {
                // not a duplicate so continue on.
                if (!arrayOfUnsuccessfulMissions.includes(currentMission) && !arrayOfSuccessfulMissions.includes(currentMission)) {
                  // We only need to add the ones who weren't already marked unsuccessful. and check for duplicates
                  arrayOfSuccessfulMissions.push(currentMission);
                  arrayOfTimes.push(currentTime);
                }
              }
            }

            // Now we need to loop, per month.
            for (var j = 1; j < 13; j++) {
              total = 0;
              if (j < 10) {
                var currentMonth = "0" + j;
              }
              else {
                var currentMonth = j;
              }

              var startDate = year + "-" + currentMonth + "-01";
              var endDate = year + "-" + currentMonth + "-31";

              for (var k = 0; k < arrayOfTimes.length; k++) {
                if (arrayOfTimes[k] <= endDate && arrayOfTimes[k] >= startDate) {
                  total++;
                }
              }
              countYearly.push(total);
            }
            yearDvOptions.series.push({
              name: "Successful Missions",
              data: countYearly
            });
            for (i = 0; i < countYearly.length; i++) {
              yearSuccessful = yearSuccessful + countYearly[i];
            }
          }
        },
        error: function (data) {
          //alert("Error: " + JSON.stringify(data));
        }
      });
      if ($('#dvYearlyGraph').highcharts())
        $('#dvYearlyGraph').highcharts().destroy();
      var dvYearlyChart = new Highcharts.Chart(yearDvOptions);

      // Now lets calculate mission success rate for the year:
      var totalYearMissions = yearSuccessful + yearUnsuccessful;
      var percentageMission = yearSuccessful / totalYearMissions * 100;
      //$("#missionSuccessRate").text(Math.round(percentageMission) + "%");
      var startDate = $('#start_date').val() + "T00:00:00Z";
      var endDate = $('#end_date').val() + "T23:59:59Z";
      updateInformation(startDate, endDate);
      // Now we need to calculate this month's aircraft success rate.
      // This will be done on the first selection of the DV.
      // We will just make a call to the below function as that function can be reused with a select event.
    }




    // Global Variables
    var unsuccessfulMissions = [];
    var totalMissions = 0;
    var totalLegs = 0;
    var categories = [];
    var totalTickets = 0;
    var tails = [];
    function updateInformation(startDate, endDate) {
      tails = [];
      ticketsPerCategory.series = [];
      percentLegsIssues.series = [];
      percentLegsIssues.xAxis.categories = [];
      ticketsPerTail.xAxis.categories = [];
      ticketsPerTail.series = [];
      issuesPerLeg.xAxis.categories = [];
      issuesPerLeg.series = [];
      unsuccessfulMissions = [];
      totalMissions = 0;
      totalLegs = 0;
      categories = [];
      totalTickets = 0;
      // Get current DV
      var dv = $('#dv_select_2').val();
      if (dv) {
        // If DV selected

        // First get total CCIR since we cant do that in another loop
        $("#total_ccirs").text(totalCCIRs(startDate, endDate, dv));
        ticketProcessing(startDate, endDate, dv);
        $("#total_tickets").text(totalTickets);
        missionProcessing(startDate, endDate, dv);
        $("#total_missions").text(totalMissions);
        $("#total_legs").text(totalLegs);
        ticketsPerTailFunc(startDate, endDate, dv);
        issuesPerLegFunc(startDate, endDate, dv);

      }
    }

    function totalCCIRs(startDate, endDate, dv) {
      var total = 0;
      var urlLoad = "https://intelshare.intelink.gov/sites/89cs/GNOC/_api/web/lists/getbytitle('CCIR')/items?$top=5000&$filter=Date le '" + endDate + "' and Date ge '" + startDate + "' and DV eq '" + dv + "'";
      $.ajax({
        url: urlLoad,
        async: false,
        method: "GET",
        headers: {
          "Accept": "application/json;odata=verbose"
        },
        success: function (data) {
          var arrayOfTimes = []; // times of tickets unique to mission number
          var allResults = data.d.results;
          if (Number(allResults.length) > 0) {
            for (var i = 0; i < Number(allResults.length); i++) {
              // looping through all results
              var currentTime = allResults[i].Created;
              if (!arrayOfTimes.includes(currentTime)) {
                total++;
                arrayOfTimes.push(currentTime);
              }
            }
          }
        },
        error: function (data) {
          //alert("Error: " + JSON.stringify(data));
        }
      });
      return total;
    }

    function ticketProcessing(startDate, endDate, dv) {
      // Get ticket categories
      var urlLoad = "https://intelshare.intelink.gov/sites/89cs/GNOC/_api/web/lists/getbytitle('Ticket_Categories')/items?$orderby=Category%20asc";
      $.ajax({
        url: urlLoad,
        async: false,
        method: "GET",
        headers: {
          "Accept": "application/json;odata=verbose"
        },
        success: function (data) {
          var allResults = data.d.results;
          if (Number(allResults.length) > 0) {
            for (var i = 0; i < Number(allResults.length); i++) {
              var total = 0;
              var currentCategory = allResults[i].Category;
              // now loop through tickets to find how many tickets for this category
              var urlLoad = "https://intelshare.intelink.gov/sites/89cs/GNOC/_api/web/lists/getbytitle('Tickets')/items?$top=5000&$filter=Category eq '" + currentCategory + "' and Created le '" + endDate + "' and Created ge '" + startDate + "' and DV eq '" + dv + "'";
              $.ajax({
                url: urlLoad,
                async: false,
                method: "GET",
                headers: {
                  "Accept": "application/json;odata=verbose"
                },
                success: function (data) {
                  var arrayOfTimes = [];
                  var dataResults = data.d.results;
                  if (Number(dataResults.length) > 0) {
                    for (var j = 0; j < Number(dataResults.length); j++) {
                      if (dataResults[j].Category = currentCategory && !arrayOfTimes.includes(dataResults[j].Created)) {
                        if (!unsuccessfulMissions.includes(dataResults[j].Mission_Number)) {
                          unsuccessfulMissions.push(dataResults[j].Mission_Number); // add mission as non successful
                        }
                        if (!tails.includes(dataResults[j].Tail_Number)) {
                          tails.push(dataResults[j].Tail_Number);
                        }
                        arrayOfTimes.push(dataResults[j].Created); // to make sure no duplicates
                        total++;
                        totalTickets++;
                      }
                    }
                  }
                }
              });
              // Now we got total for category - lets push it
              if (total != 0) {
                categories.push({
                  name: currentCategory,
                  y: total
                });
              }
            }
          }
        },
      });


      // Now done with loop, lets push all the data
      ticketsPerCategory.series.push({
        name: 'Categories',
        data: categories,
        size: '70%',
        innerSize: '90%',
        showInLegend: true,
        dataLabels: {
          enabled: false
        }
      });

      var chart = new Highcharts.Chart(ticketsPerCategory);
    }

    function missionProcessing(startDate, endDate, dv) {
      // Total Missions
      var percentSuccess = 0;
      var missions = [];
      var urlLoad2 = "https://intelshare.intelink.gov/sites/89cs/GNOC/_api/web/lists/getbytitle('Missions')/items?$top=5000&$filter=DV eq '" + dv + "' and Created le '" + endDate + "' and Created ge '" + startDate + "'";
      $.ajax({
        url: urlLoad2,
        async: false,
        method: "GET",
        headers: {
          "Accept": "application/json;odata=verbose"
        },
        success: function (data) {
          var allResults = data.d.results;
          var arrayOfTimes = [];
          if (Number(allResults.length) > 0) {
            for (var j = 0; j < Number(allResults.length); j++) {
              // looping through all results
              var currentTime = allResults[j].Departure_Date;
              var currentMission = allResults[j].Mission_Number;

              if (!arrayOfTimes.includes(currentTime)) {
                // not a duplicate so continue on.
                if (!missions.includes(currentMission)) {
                  missions.push(currentMission);
                  totalMissions++;
                }

                totalLegs++;

                if (!unsuccessfulMissions.includes(currentMission)) {
                  // We only need to add the ones who weren't already marked unsuccessful.

                  arrayOfTimes.push(currentTime);
                }
              }
            }
            percentLegsIssues.xAxis.categories.push(dv);
            percentSuccess = ((totalMissions - unsuccessfulMissions.length) / totalMissions) * 100;
            percentSuccess = Math.round(percentSuccess);
          }
        }
      });

      percentLegsIssues.series.push({
        name: 'Percentage of Missions without Issues',
        colorByPoint: true,
        data: [percentSuccess]
      });

      var chart2 = new Highcharts.Chart(percentLegsIssues);
    }

    function ticketsPerTailFunc(startDate, endDate, dv) {
      var highArr = [];
      var medArr = [];
      var lowArr = [];
      var noneArr = [];

      for (var i = 0; i < tails.length; i++) {
        // Loop through each a/c
        // Lets see if any tickets exist for said a/c
        // First lets pull ALL of the tickets TOTAL
        var urlLoad = "https://intelshare.intelink.gov/sites/89cs/GNOC/_api/web/lists/getbytitle('Tickets')/items?$top=5000&$filter=Tail_Number eq '" + tails[i] + "' and Created le '" + endDate + "' and Created ge '" + startDate + "' and DV eq '" + dv + "'";
        $.ajax({
          url: urlLoad,
          async: false,
          method: "GET",
          headers: {
            "Accept": "application/json;odata=verbose"
          },
          success: function (data) {
            var dataResults = data.d.results;
            if (Number(dataResults.length) > 0) {
              // Found tickets for said a/c
              // Lets push this to an x-category on the chart
              ticketsPerTail.xAxis.categories.push(tails[i]);

              // Data = [None, Low, Medium, High];
              var high = 0;
              var med = 0;
              var low = 0;
              var none = 0;
              for (var j = 0; j < Number(dataResults.length); j++) {
                // Going through tickets for said a/c
                if (dataResults[j].Impact_Level == "High") {
                  high++;
                } else if (dataResults[j].Impact_Level == "Medium") {
                  med++;
                } else if (dataResults[j].Impact_Level == "Low") {
                  low++;
                } else {
                  none++;
                }
              }
              highArr.push(high);
              medArr.push(med);
              lowArr.push(low);
              noneArr.push(none);
            }
          }
        });
      }


      ticketsPerTail.series.push({
        name: 'High',
        data: highArr
      })
      ticketsPerTail.series.push({
        name: 'Med',
        data: medArr
      })
      ticketsPerTail.series.push({
        name: 'Low',
        data: lowArr
      })
      ticketsPerTail.series.push({
        name: 'None',
        data: noneArr
      })
      var chart = new Highcharts.Chart(ticketsPerTail);

    }


    function exists(arr, search) {
      return arr.some(row => row.includes(search));
    }

    function getRow(arr, search) {
      for (var i = 0; i < arr.length; i++) {
        if (arr[i][0] == search)
          return i;
      }
    }

    function issuesPerLegFunc(start, end, dv) {
      var months = [];
      var success = [];
      var impact = [];
      var noImpact = [];

      var parseStart = moment(new Date(start)).utc();
      //console.log(parseStart.toDate() + " and " + parseStart.toISOString());
      var startMonth = parseStart.month();
      var parseEnd = moment(new Date(end)).utc();

      //console.log(parseStart.month() + " - " + parseEnd.month());
      var breakOut = 0;
      while (true) {
        // if we aren't in same month as the end date, but in the same month as the start date make the search date to the end of the month
        if (parseStart.month() == startMonth && parseStart.month() != parseEnd.month()) {
          // current month is same as start month.
          start = parseStart.toISOString();
          end = parseStart.year() + "-" + (parseStart.month() + 1) + "-" + parseStart.endOf('month').toDate().getDate() + "T23:59:59Z";
        }
        else if (parseStart.month() != startMonth && parseStart.month() != parseEnd.month()) {
          start = parseStart.startOf('month').startOf('day').toISOString();
          end = parseStart.endOf('month').endOf('day').toISOString();
        }
        else {
          // Same months
          start = parseStart.startOf('month').startOf('day').toISOString();
          end = parseEnd.toISOString();
          breakOut = 1;
        }

        // Now run the equations
        var urlLoad = "https://intelshare.intelink.gov/sites/89cs/GNOC/_api/web/lists/getbytitle('Missions')/items?$filter=DV eq '" + dv + "' and Created le '" + end + "' and Created ge '" + start + "'&$orderby=Created%20desc";
        var successfulLegs = 0;
        var impactLegs = 0;
        var noImpactLegs = 0;
        var missionArry = [];
        $.ajax({
          url: urlLoad,
          async: false,
          method: "GET",
          headers: {
            "Accept": "application/json;odata=verbose"
          },
          success: function (data) {
            var allResults = data.d.results;
            if (Number(allResults.length) > 0) {
              for (var i = 0; i < Number(allResults.length); i++) {
                if (!exists(missionArry, allResults[i].Mission_Number)) {
                  missionArry.push([allResults[i].Mission_Number, 1])
                }
                else {
                  var row = getRow(missionArry, allResults[i].Mission_Number);
                  missionArry[row][1]++;
                }

              }
            }
          }
        });

        for (var i = 0; i < missionArry.length; i++) {
          // loop through each mission to get final values
          var mission = missionArry[i][0];
          var urlLoad = "https://intelshare.intelink.gov/sites/89cs/GNOC/_api/web/lists/getbytitle('Tickets')/items?$filter=DV eq '" + dv + "' and Mission_Number eq '" + mission + "' and Date_Opened le '" + end + "' and Date_Opened ge '" + start + "' &$orderby=Created%20desc";
          $.ajax({
            url: urlLoad,
            async: false,
            method: "GET",
            headers: {
              "Accept": "application/json;odata=verbose"
            },
            success: function (data) {
              var allResults = data.d.results;
              if (Number(allResults.length) > 0) {
                for (var i = 0; i < Number(allResults.length); i++) {
                  if (allResults[i].Leg != "N/A") {
                    // Check for DV Impact
                    if (allResults[i].DV_Impact == true) {
                      impactLegs++;
                      missionArry[i][1]--;
                    }
                    else {
                      noImpactLegs++;
                      missionArry[i][1]--;
                    }
                  }
                }
              }
            }
          });
        }

        // calculate success legs
        for (var i = 0; i < missionArry.length; i++) {
          successfulLegs = successfulLegs + missionArry[i][1];
        }
        /*
        $.ajax({
          url: urlLoad,
          async: false,
          method: "GET",
          headers: {
            "Accept": "application/json;odata=verbose"
          },
          success: function (data) {
            var allResults = data.d.results;
            if (Number(allResults.length) > 0) {
              for (var i = 0; i < Number(allResults.length); i++) {
                // for each mission search for ticket (mission in this case is = to a leg) that falls in that mission
                var depDate = new Date(allResults[i].Departure_Date);
                depDate.setHours(depDate.getHours() - depDate.getTimezoneOffset() / 60);
                depDate = depDate.toISOString();
                //var m = depDate.getMonth() + 1;
                //depDate = depDate.getFullYear() + "-" + ("0" + m).slice(-2) + "-" + ("0" + depDate.getDate()).slice(-2) + "T" + ("0" + depDate.getHours()).slice(-2) + ":" + ("0" + depDate.getMinutes()).slice(-2) + ":" + ("0" + depDate.getSeconds()).slice(-2) + "Z";
                var arrDate = new Date(allResults[i].Arrival_Date);
                arrDate.setHours(arrDate.getHours() - arrDate.getTimezoneOffset() / 60);
                arrDate = arrDate.toISOString();
                //m = arrDate.getMonth() + 1;
                //arrDate = arrDate.getFullYear() + "-" + ("0" + m).slice(-2) + "-" + ("0" + arrDate.getDate()).slice(-2) + "T" + ("0" + arrDate.getHours()).slice(-2) + ":" + ("0" + arrDate.getMinutes()).slice(-2) + ":" + ("0" + arrDate.getSeconds()).slice(-2) + "Z";
                var mission = allResults[i].Mission_Number
                //console.log("Mission #: " + mission + " departed on " + depDate + " and arrived on " + arrDate);
                //console.log(depDate);
                //console.log(arrDate);
                //console.log(mission);
                //console.log(allResults[i].Created);
                var urlLoad = "https://intelshare.intelink.gov/sites/89cs/GNOC/_api/web/lists/getbytitle('Tickets')/items?$filter=DV eq '" + dv + "' and Mission_Number eq '" + mission + "' and Date_Opened le '" + arrDate + "' and Date_Opened ge '" + depDate + "' &$orderby=Created%20desc";
                $.ajax({
                  url: urlLoad,
                  async: false,
                  method: "GET",
                  headers: {
                    "Accept": "application/json;odata=verbose"
                  },
                  success: function (data2) {
                    var allResults2 = data2.d.results;
                    var foundImpact = 0;
                    if (Number(allResults2.length) > 0) {
                      //console.log("Found tickets relating to " + mission);
                      for (var j = 0; j < Number(allResults2.length); j++) {
                        foundImpact = 0;
                        // Issue found
                        //console.log(allResults2[j].DV_Impact + " and ticket# " + allResults2[j].GNOC_Ticket_Number);
                        if (allResults2[j].DV_Impact == true) {
                          foundImpact = 1;
                        }
                      }
                      if (foundImpact == 1) {
                        impactLegs++;
                      }
                      else {
                        noImpactLegs++;
                      }
                    }
                    else {
                      // no tickets found for leg
                      successfulLegs++;
                    }
                  }
                });
              }
            }
          }
        });
        */

        months.push(parseStart.utc().format('MMMM'));
        success.push(successfulLegs);
        impact.push(impactLegs);
        noImpact.push(noImpactLegs);

        if (breakOut) {
          break;
        }

        // Add Month
        parseStart.add(1, 'months');
      }


      issuesPerLeg.xAxis.categories = months;
      issuesPerLeg.series.push({
        name: 'Legs with DV Impact',
        data: impact
      })
      issuesPerLeg.series.push({
        name: 'Legs with No Impact Issues',
        data: noImpact
      })
      issuesPerLeg.series.push({
        name: 'Legs with No Issues',
        data: success
      })
      var chart = new Highcharts.Chart(issuesPerLeg);
    }

  </script>
</head>

<body>
  <nav class="navbar navbar-dark bg-dark flex-md-nowrap p-0">
    <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="./index.html">
      <svg width="2em" height="2em" viewBox="0 0 16 16" class="bi bi-broadcast-pin" fill="currentColor"
        xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd"
          d="M3.05 3.05a7 7 0 0 0 0 9.9.5.5 0 0 1-.707.707 8 8 0 0 1 0-11.314.5.5 0 0 1 .707.707zm2.122 2.122a4 4 0 0 0 0 5.656.5.5 0 0 1-.708.708 5 5 0 0 1 0-7.072.5.5 0 0 1 .708.708zm5.656-.708a.5.5 0 0 1 .708 0 5 5 0 0 1 0 7.072.5.5 0 1 1-.708-.708 4 4 0 0 0 0-5.656.5.5 0 0 1 0-.708zm2.122-2.12a.5.5 0 0 1 .707 0 8 8 0 0 1 0 11.313.5.5 0 0 1-.707-.707 7 7 0 0 0 0-9.9.5.5 0 0 1 0-.707zM6 8a2 2 0 1 1 2.5 1.937V15.5a.5.5 0 0 1-1 0V9.937A2 2 0 0 1 6 8z" />
      </svg> &nbsp;
      <b>GNOC DV Dashboard</b>
    </a>
  </nav>
  <div class="container-fluid">
    <div class="row">
      <nav class="col-md-2 d-none d-md-block bg-light sidebar">
        <div class="sidebar-sticky">
          <ul class="nav flex-column">
            <li class="nav-item" id="dashboard_div">
              <a class="nav-link active" href="./index.html">
                <span data-feather="home"></span>
                Dashboard <span class="sr-only">(current)</span>
              </a>
            </li>
            <li class="nav-item" id="flight_schedule_div">
              <a class="nav-link" href="./flightschedule.html">
                <span data-feather="clock"></span>
                Flight Schedule
              </a>
            </li>
            <li class="nav-item" id="contact_list_div">
              <a class="nav-link" href="./contactList.html">
                <span data-feather="phone"></span>
                Contact List
              </a>
            </li>
          </ul>
          <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted"
            id="tickets_header_div">
            <span>Trouble Tickets</span>
            <a class="d-flex align-items-center text-muted" href="./ticketSettings.html" id="ticket_settings_div">
              <span data-feather="settings"></span>
            </a>
          </h6>
          <ul class="nav flex-column mb-2">
            <li class="nav-item" id="create_tts_div">
              <a class="nav-link" href="./createTTS.html">
                <span data-feather="file"></span>
                Create a TTS
              </a>
            </li>
            <li class="nav-item" id="create_master_tts_div">
              <a class="nav-link" href="./createMasterTTS.html">
                <span data-feather="file"></span>
                Create a Master TTS
              </a>
            </li>
            <li class="nav-item" id="view_tickets_div">
              <a class="nav-link" href="./viewTickets.html">
                <span data-feather="file-text"></span>
                View Tickets
              </a>
            </li>
            <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted"
              id="flight_tickets_header_div">
              <span>Flight Tickets</span>
              <a class="d-flex align-items-center text-muted" href="./createFlightTicket.html"
                id="create_flight_ticket_icon_div">
                <span data-feather="plus-circle"></span>
              </a>
            </h6>
            <ul class="nav flex-column mb-2">
              <li class="nav-item" id="create_flight_ticket_div">
                <a class="nav-link" href="./createFlightTicket.html">
                  <span data-feather="file"></span>
                  Create a Flight Ticket
                </a>
              </li>
              <li class="nav-item" id="view_flight_tickets_div">
                <a class="nav-link" href="./viewFlightTickets.html">
                  <span data-feather="file-text"></span>
                  View Flight Tickets
                </a>
              </li>
              <li class="nav-item" id="view_missions_div">
                <a class="nav-link" href="./viewMissions.html">
                  <span data-feather="file-text"></span>
                  View Missions
                </a>
              </li>
            </ul>
            <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted"
              id="ccir_header_div">
              <span>CCIRs</span>
              <a class="d-flex align-items-center text-muted" href="./createCCIR.html" id="add_a_ccir_icon_div">
                <span data-feather="plus-circle"></span>
              </a>
            </h6>
            <ul class="nav flex-column mb-2">
              <li class="nav-item" id="add_a_ccir_div">
                <a class="nav-link" href="./createCCIR.html">
                  <span data-feather="file"></span>
                  Add a CCIR
                </a>
              </li>
              <li class="nav-item" id="view_ccirs_div">
                <a class="nav-link" href="./viewCCIRS.html">
                  <span data-feather="file-text"></span>
                  View CCIRs
                </a>
              </li>
            </ul>
            <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted"
              id="reports_header_div">
              <span>Reports</span>
            </h6>
            <ul class="nav flex-column mb-2">
              <li class="nav-item" id="24_hour_report_div">
                <a class="nav-link" href="./ticketReport.html">
                  <span data-feather="file-text"></span>
                  24 Hour Ticket Report
                </a>
              </li>
              <li class="nav-item" id="weekend_report_div">
                <a class="nav-link" href="./weekendTicketReport.html">
                  <span data-feather="file-text"></span>
                  Weekend Ticket Report
                </a>
              </li>
              <li class="nav-item" id="morning_slides_div">
                <a class="nav-link" href="./morningSlides.html">
                  <span data-feather="file-text"></span>
                  Morning Slides
                </a>
              </li>
              <li class="nav-item" id="personnel_stats_div">
                <a class="nav-link" href="./personnelStats.html">
                  <span data-feather="file-text"></span>
                  Personnel Stats
                </a>
              </li>
              <li class="nav-item" id="monthly_metrics_div">
                <a class="nav-link" href="./metrics.html">
                  <span data-feather="file-text"></span>
                  Monthly Metrics
                </a>
              </li>
              <li class="nav-item" id="permissions_div">
                <a class="nav-link" href="./permissions.html">
                  <span data-feather="file-text"></span>
                  Permissions
                </a>
              </li>
            </ul>
        </div>
      </nav>
      <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4">
        <div
          class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
          <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
              <a class="nav-link" id="home-tab" href="./index.html" role="tab" aria-controls="home"
                aria-selected="false">Overview</a>
            </li>
            <li class="nav-item" role="presentation">
              <a class="nav-link active" id="profile-tab" data-toggle="tab" href="./dvdetails.html" role="tab"
                aria-controls="profile" aria-selected="true">DV Details</a>
            </li>
            <li class="nav-item" role="presentation">
              <a class="nav-link" id="contact-tab" href="./opentickets.html" role="tab" aria-controls="contact"
                aria-selected="false">Open Tickets</a>
            </li>
          </ul>
        </div>
        <div class="tab-content" id="myTabContent">
          <div class="tab-pane fade show active" id="dvdetails" role="tabpanel" aria-labelledby="dvdetails-tab">
            <br />
            <div class="row col-md-12">
              <h1>DV Details</h1>
              <select class="selectpicker float-right col-4" id="dv_select_2" data-live-search="true" data-size="5"
                data-actions-box="true" title="Select a DV...">
              </select>
            </div>
            <hr>
            <div class="col-md-12 card-columns d-flex justify-content-center">
              <div class="card">
                <div class="card-header">
                  <b>Set Date</b>
                </div>
                <div class="card-body text-center">
                  <input class="form-control" name="start_date" type="date" id="start_date">
                  <b>To</b>
                  <input class="form-control" name="end_date" type="date" id="end_date">
                </div>
              </div>
              <div class="card">
                <div class="card-header">
                  <b>Total CCIRs</b>
                </div>
                <div class="card-body text-center">
                  <h1><span id="total_ccirs">XX</span></h1>
                </div>
              </div>
              <div class="card">
                <div class="card-header">
                  <b>Total Tickets</b>
                </div>
                <div class="card-body text-center">
                  <h1><span id="total_tickets">XX</span></h1>
                </div>
              </div>
              <div class="card">
                <div class="card-header">
                  <b>Total Missions</b>
                </div>
                <div class="card-body text-center">
                  <h1><span id="total_missions">XX</span></h1>
                </div>
              </div>
              <div class="card">
                <div class="card-header">
                  <b>Total Legs</b>
                </div>
                <div class="card-body text-center">
                  <h1><span id="total_legs">XX</span></h1>
                </div>
              </div>
            </div>
            <div class="col-md-12 card-columns d-flex justify-content-center">
              <div class="card">
                <div class="card-header">
                  <b>Tickets per Tail</b>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-12">
                      <div id="ticketsPerTail" class="text-center">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card">
                <div class="card-header">
                  <b>Percentage of Missions without Issues</b>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-12">
                      <div id="percentLegsWithoutIssues" class="text-center">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card">
                <div class="card-header">
                  <b>Total Tickets by Category</b>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-12">
                      <div id="ticketsPerCategory" class="text-center">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-12 card-columns d-flex justify-content-center">
              <div class="card">
                <div class="card-header">
                  <b>Issues Per Leg</b>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-12">
                      <div id="dvIssuesPerLeg" class="text-center">
                        Select a DV from the drop down above.
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card">
                <div class="card-header">
                  <b>Year Analysis</b>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-12">
                      <div id="dvYearlyGraph" class="text-center">
                        Select a DV from the drop down above.
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <br>
            <div class="col-md-12">
              <div class="card">
                <div class="card-header">
                  <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-sticky-fill" fill="currentColor"
                    xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                      d="M2.5 1A1.5 1.5 0 0 0 1 2.5v11A1.5 1.5 0 0 0 2.5 15h6.086a1.5 1.5 0 0 0 1.06-.44l4.915-4.914A1.5 1.5 0 0 0 15 8.586V2.5A1.5 1.5 0 0 0 13.5 1h-11zm6 8.5v4.396c0 .223.27.335.427.177l5.146-5.146a.25.25 0 0 0-.177-.427H9.5a1 1 0 0 0-1 1z" />
                  </svg>&nbsp;
                  <b>Open Tickets</b>
                </div>
                <div class="row col-md-12">
                  <div class="card-body">
                    <table id="dvOpenTickets" class="display" style="width:100%">
                      <thead>
                        <tr>
                          <th>Ticket #</th>
                          <th>Date Opened</th>
                          <th>Tail</th>
                          <th>Mission</th>
                          <th>DV</th>
                          <th>DV Impact</th>
                          <th>Category</th>
                          <th>Status</th>
                          <th>Issue Description</th>
                          <th>Last Reported Action</th>
                          <th>Update Date</th>
                        </tr>
                      </thead>
                      <tbody>
                      </tbody>
                      <tfoot>
                        <tr>
                          <th>Ticket #</th>
                          <th>Date Opened</th>
                          <th>Tail</th>
                          <th>Mission</th>
                          <th>DV</th>
                          <th>DV Impact</th>
                          <th>Category</th>
                          <th>Status</th>
                          <th>Issue Description</th>
                          <th>Last Reported Action</th>
                          <th>Update Date</th>
                        </tr>
                      </tfoot>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
      <br />
      <footer class="py-4 col-md-2 bg-light" style="box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1);">
        <div class="container-fluid">
          <div class="d-flex align-items-center justify-content-between small">
            <div class="text-muted">GNOC DV Dashboard - maintained by GNOC @ JBA<br />
              <a href="mailto:89CS.SCOV.VIP.COMM@us.af.mil">89CS.SCOV.VIP.COMM@us.af.mil</a>
            </div>
          </div>
        </div>
      </footer>
    </div>
  </div>
</body>

</html>