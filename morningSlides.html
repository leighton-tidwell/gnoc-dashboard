<html>

<head>
  <title>GNOC DV Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.6.4/css/buttons.dataTables.min.css" />
  <link rel="stylesheet" href="./css/global.css" />

  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.3.1/dist/pptxgen.bundle.js"></script>
  <script type="text/javascript" src="./js/user.js"></script>
  <script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script>
  <script>
    var day = new Date();
    if (day.getUTCDay() == 0) {
      // get weekend report
      var now;
      var yesterday = new Date(); // last friday
      const t = new Date().getDate() + (6 - new Date().getDay() - 1) - 7;
      yesterday.setDate(t);

      Date.prototype.addDays = function (days) {
        var date = new Date(this.valueOf());
        date.setDate(date.getDate() + days);
        return date;
      }
      now = new Date(yesterday);
      now = now.addDays(3);
      var day = ("0" + now.getDate()).slice(-2);
      var previousDay = ("0" + (yesterday.getDate())).slice(-2);
      var month = ("0" + (now.getMonth() + 1)).slice(-2);
      var previousMonth = ("0" + (yesterday.getMonth() + 1)).slice(-2);
    }
    else {
      // get yesterday report
      var now = new Date();
      var yesterday = new Date();
      var day = ("0" + now.getDate()).slice(-2);
      yesterday.setDate(now.getDate() - 1);
      var previousDay = ("0" + (yesterday.getDate())).slice(-2);
      var month = ("0" + (now.getMonth() + 1)).slice(-2);
      var previousMonth = ("0" + (yesterday.getMonth() + 1)).slice(-2);
    }



    var startDate = now.getFullYear() + "-" + (previousMonth) + "-" + (previousDay) + "T13:00:00Z";
    var endDate = now.getFullYear() + "-" + (month) + "-" + (day) + "T13:00:00Z";
    var todayDate = now.getFullYear() + "-" + (month) + "-" + (day) + "T00:00:00Z";
    var todayDateEnd = now.getFullYear() + "-" + (month) + "-" + (day) + "T23:59:59Z";

    console.log(previousDay);
    console.log(day);
    $(function () {

      // Check permissions of page:
      if (!checkPermissions("TU9STklORyBTTElERVM=", false, true)) {
        $("html").remove();
      }

      // Permissions of content if page true and let page content run
      if (checkPermissions("TU9STklORyBTTElERVM=", false, false)) {


        // nav
        checkPermissions("REFTSEJPQVJE", "dashboard_div", false);
        checkPermissions("RkxJR0hUIFNDSEVEVUxF", "flight_schedule_div", false);
        checkPermissions("Q09OVEFDVCBMSVNU", "contact_list_div", false);
        if (!checkPermissions("Q1JFQVRFIFRUUw==", "create_tts_div", false) && !checkPermissions("Q1JFQVRFIE1BU1RFUiBUVFM=", "create_master_tts_div", false) && !checkPermissions("VElDS0VUIFNFVFRJTkdT", "ticket_settings_div", false) && !checkPermissions("VklFVyBUSUNLRVRT", "view_tickets_div", false)) {
          $("#tickets_header_div").remove();
        }
        checkPermissions("Q1JFQVRFIFRUUw==", "create_tts_div", false);
        checkPermissions("Q1JFQVRFIE1BU1RFUiBUVFM=", "create_master_tts_div", false);
        checkPermissions("VElDS0VUIFNFVFRJTkdT", "ticket_settings_div", false);
        checkPermissions("VklFVyBUSUNLRVRT", "view_tickets_div", false);
        if (!checkPermissions("Q1JFQVRFIEZMSUdIVCBUSUNLRVQ=", "create_flight_ticket_div", false) && !checkPermissions("VklFVyBGTElHSFQgVElDS0VUUw==", "view_flight_tickets_div", false) && !checkPermissions("VklFVyBNSVNTSU9OUw==", "view_missions_div", false)) {
          $("#flight_tickets_header_div").remove();
        }
        checkPermissions("Q1JFQVRFIEZMSUdIVCBUSUNLRVQ=", "create_flight_ticket_div", false);
        checkPermissions("Q1JFQVRFIEZMSUdIVCBUSUNLRVQ=", "create_flight_ticket_icon_div", false);
        checkPermissions("VklFVyBGTElHSFQgVElDS0VUUw==", "view_flight_tickets_div", false);
        checkPermissions("VklFVyBNSVNTSU9OUw==", "view_missions_div", false);
        if (!checkPermissions("QUREIEEgQ0NJUg==", "add_a_ccir_div", false) && !checkPermissions("VklFVyBDQ0lSUw==", "view_ccirs_div", false)) {
          $("#ccir_header_div").remove();
        }
        checkPermissions("QUREIEEgQ0NJUg==", "add_a_ccir_div", false);
        checkPermissions("QUREIEEgQ0NJUg==", "add_a_ccir_icon_div", false);
        checkPermissions("VklFVyBDQ0lSUw==", "view_ccirs_div", false);
        if (!checkPermissions("MjQgSE9VUiBSRVBPUlQ=", "24_hour_report_div", false)) {
          $("#reports_header_div").remove();
        }
        checkPermissions("MjQgSE9VUiBSRVBPUlQ=", "24_hour_report_div", false);
        checkPermissions("V0VFS0VORCBUSUNLRVQgUkVQT1JU", "weekend_report_div", false);
        checkPermissions("TU9STklORyBTTElERVM=", "morning_slides_div", false);
        checkPermissions("UEVSU09OTkVMIFNUQVRT", "personnel_stats_div", false);
        checkPermissions("TUVUUklDUw==", "monthly_metrics_div", false);
        checkPermissions("UEVSTUlTU0lPTlM=", "permissions_div", false);



        $("#start_date").html(convertDate(startDate, 1));
        $("#end_date").html(convertDate(endDate, 1));

        // Get all of the open tickets:
        var urlLoad = "https://intelshare.intelink.gov/sites/89cs/GNOC/_api/web/lists/getbytitle('Tickets')/items?$top=5000&$filter=Status eq 'New' or Status eq 'ASSIGNED'&$orderby=Created%20asc";
        $.ajax({
          url: urlLoad,
          async: false,
          method: "GET",
          headers: {
            "Accept": "application/json;odata=verbose"
          },
          success: function (data) {
            var arrayOfTimes = [];
            var allResults = data.d.results;
            var curr_table = 1;
            var table = document.getElementById("open_tickets_" + curr_table + "").getElementsByTagName('tbody')[0];
            if (Number(allResults.length) > 0) {
              for (var i = 0; i < Number(allResults.length); i++) {
                var currentTime = allResults[i].Created;
                if (!arrayOfTimes.includes(currentTime)) {

                  var href = allResults[i].GNOC_Ticket_Number;
                  var dateOpened = convertDate(allResults[i].Date_Opened, 1);
                  var dv = allResults[i].DV;
                  if (dv == null)
                    dv = "N/A";
                  var ac = allResults[i].Tail_Number;
                  if (ac == null)
                    ac = "N/A";
                  var impact = allResults[i].Impact_Level;
                  if (impact == null)
                    impact = "N/A";
                  var summary = allResults[i].Issue_Description;
                  if (summary == null)
                    summary = "N/A";
                  if (allResults[i].Mission_Number == null)
                    var missionhref = "N/A";
                  else
                    var missionhref = allResults[i].Mission_Number;

                  if (allResults[i].CCIR == false)
                    var ccir = "No";
                  else
                    var ccir = "Yes";
                  /*if(document.getElementById("open_tickets_" + curr_table + "").offsetHeight >= 1000){
                    curr_table++;
                    console.log(curr_table);
                    $("nav-openTickets").append("<table class=\"table table-striped\" id=\"open_tickets_" + curr_table + "\"><thead class=\"thead-light\"><tr><th style=\"width:200px;\">Date</th><th>DV</th><th>A/C</th><th style=\"width:200px;\">Ticket #</th><th>CCIR</th><th style=\"width:100px;\">DV Impact</th><th>Summary</th></tr></thead><tbody></tbody></table>");
                  }*/
                  var row = table.insertRow(0);
                  var date_cell = row.insertCell(0);
                  date_cell.innerHTML = dateOpened;
                  var dv_cell = row.insertCell(1);
                  dv_cell.innerHTML = dv;
                  var mission_cell = row.insertCell(2);
                  mission_cell.innerHTML = missionhref;
                  var ac_cell = row.insertCell(3);
                  ac_cell.innerHTML = ac;
                  var ticket_cell = row.insertCell(4);
                  ticket_cell.innerHTML = href;
                  var ccir_cell = row.insertCell(5);
                  ccir_cell.innerHTML = ccir;
                  var impact_cell = row.insertCell(6);
                  impact_cell.innerHTML = impact;
                  var summary_cell = row.insertCell(7);
                  summary_cell.innerHTML = summary;
                  summary = summary.replace(/\n/g, "");
                  if (i % 2 == 0) {
                    openRows.push(
                      [
                        { text: dateOpened, options: { breakLine: false, autoFit: true, w: '100%', fill: 'd9d9d9' } },
                        { text: dv, options: { breakLine: false, autoFit: true, w: '100%', fill: 'd9d9d9' } },
                        { text: missionhref, options: { breakLine: false, autoFit: true, w: '100%', fill: 'd9d9d9' } },
                        { text: ac, options: { breakLine: false, autoFit: true, w: '100%', fill: 'd9d9d9' } },
                        { text: href, options: { breakLine: false, autoFit: true, w: '100%', fill: 'd9d9d9' } },
                        { text: ccir, options: { breakLine: false, autoFit: true, w: '100%', fill: 'd9d9d9' } },
                        { text: impact, options: { breakLine: false, autoFit: true, w: '100%', fill: 'd9d9d9' } },
                        { text: summary, options: { breakLine: false, autoFit: true, w: '100%', shrinkText: true, fill: 'd9d9d9' } },
                      ]);
                  }
                  else {
                    openRows.push(
                      [
                        { text: dateOpened, options: { breakLine: false, autoFit: true, w: '100%' } },
                        { text: dv, options: { breakLine: false, autoFit: true, w: '100%' } },
                        { text: missionhref, options: { breakLine: false, autoFit: true, w: '100%' } },
                        { text: ac, options: { breakLine: false, autoFit: true, w: '100%' } },
                        { text: href, options: { breakLine: false, autoFit: true, w: '100%' } },
                        { text: ccir, options: { breakLine: false, autoFit: true, w: '100%' } },
                        { text: impact, options: { breakLine: false, autoFit: true, w: '100%' } },
                        { text: summary, options: { breakLine: false, autoFit: true, w: '100%', shrinkText: true } },
                      ]);

                  }


                  arrayOfTimes.push(currentTime);
                }
              }
            }
          },
          error: function (data) {
            //alert("Error: " + JSON.stringify(data));
          }
        });


        // Get all of the fixed tickets:
        var urlLoad = "https://intelshare.intelink.gov/sites/89cs/GNOC/_api/web/lists/getbytitle('ticketUpdates')/items?$top=5000&$filter=Created le '" + endDate + "' and Created ge '" + startDate + "'";
        $.ajax({
          url: urlLoad,
          async: false,
          method: "GET",
          headers: {
            "Accept": "application/json;odata=verbose"
          },
          success: function (data) {
            var arrayOfTimes = [];
            var curr_table = 1;
            var table = document.getElementById("fixed_tickets_" + curr_table + "").getElementsByTagName('tbody')[0];
            var allResults = data.d.results;
            if (Number(allResults.length) > 0) {
              for (var i = 0; i < Number(allResults.length); i++) {
                // looping through all results
                var currentTime = allResults[i].Created;
                var updateMessage = allResults[i].update;
                var updateString = "GNOC set ticket #" + allResults[i].ticket_number + " to FIXED.";
                if (!arrayOfTimes.includes(currentTime) && updateMessage == updateString) {
                  // this is to make sure no duplicates are included and only update statuses with fixed tickets are included
                  urlLoad = "https://intelshare.intelink.gov/sites/89cs/GNOC/_api/web/lists/getbytitle('Tickets')/items?$filter=GNOC_Ticket_Number eq '" + allResults[i].ticket_number + "'";
                  $.ajax({
                    url: urlLoad,
                    async: false,
                    method: "GET",
                    headers: {
                      "Accept": "application/json;odata=verbose"
                    },
                    success: function (data) {
                      var results = data.d.results;
                      if (Number(results.length) > 0 && results[0].Status == "FIXED") {
                        console.log("ticket found");
                        var href = results[0].GNOC_Ticket_Number;
                        var dateOpened = convertDate(results[0].Date_Opened, 1);
                        var dv = results[0].DV;
                        if (dv == null)
                          dv = "N/A";
                        var ac = results[0].Tail_Number;
                        if (ac == null)
                          ac = "N/A";
                        var impact = results[0].Impact_Level;
                        if (impact == null)
                          impact = "N/A";
                        var summary = results[0].Issue_Description;
                        if (summary == null)
                          summary = "N/A";
                        if (results[0].Mission_Number == null)
                          var missionhref = "N/A";
                        else
                          var missionhref = results[0].Mission_Number;

                        if (results[0].CCIR == false)
                          var ccir = "No";
                        else
                          var ccir = "Yes";

                        var fixed = results[0].Last_Reported_Action;

                        var row = table.insertRow(0);
                        var date_cell = row.insertCell(0);
                        date_cell.innerHTML = dateOpened;
                        var dv_cell = row.insertCell(1);
                        dv_cell.innerHTML = dv;
                        var mission_cell = row.insertCell(2);
                        mission_cell.innerHTML = missionhref;
                        var ac_cell = row.insertCell(3);
                        ac_cell.innerHTML = ac;
                        var ticket_cell = row.insertCell(4);
                        ticket_cell.innerHTML = href;
                        var ccir_cell = row.insertCell(5);
                        ccir_cell.innerHTML = ccir;
                        var impact_cell = row.insertCell(6);
                        impact_cell.innerHTML = impact;
                        var summary_cell = row.insertCell(7);
                        summary_cell.innerHTML = summary;
                        var fixed_cell = row.insertCell(8);
                        fixed_cell.innerHTML = fixed;
                        summary = summary.replace(/\n/g, "");
                        fixed = fixed.replace(/\n/g, "");
                        if (i % 2 == 0) {
                          fixedRows.push(
                            [
                              { text: dateOpened, options: { breakLine: false, autoFit: true, w: '100%', fill: 'd9d9d9' } },
                              { text: dv, options: { breakLine: false, autoFit: true, w: '100%', fill: 'd9d9d9' } },
                              { text: missionhref, options: { breakLine: false, autoFit: true, w: '100%', fill: 'd9d9d9' } },
                              { text: ac, options: { breakLine: false, autoFit: true, w: '100%', fill: 'd9d9d9' } },
                              { text: href, options: { breakLine: false, autoFit: true, w: '100%', fill: 'd9d9d9' } },
                              { text: ccir, options: { breakLine: false, autoFit: true, w: '100%', fill: 'd9d9d9' } },
                              { text: impact, options: { breakLine: false, autoFit: true, w: '100%', fill: 'd9d9d9' } },
                              { text: summary, options: { breakLine: false, autoFit: true, w: '100%', shrinkText: true, fill: 'd9d9d9' } },
                              { text: fixed, options: { breakLine: false, autoFit: true, w: '100%', shrinkText: true, fill: 'd9d9d9' } },
                            ]);
                        }
                        else {
                          fixedRows.push(
                            [
                              { text: dateOpened, options: { breakLine: false, autoFit: true, w: '100%' } },
                              { text: dv, options: { breakLine: false, autoFit: true, w: '100%' } },
                              { text: missionhref, options: { breakLine: false, autoFit: true, w: '100%' } },
                              { text: ac, options: { breakLine: false, autoFit: true, w: '100%' } },
                              { text: href, options: { breakLine: false, autoFit: true, w: '100%' } },
                              { text: ccir, options: { breakLine: false, autoFit: true, w: '100%' } },
                              { text: impact, options: { breakLine: false, autoFit: true, w: '100%' } },
                              { text: summary, options: { breakLine: false, autoFit: true, w: '100%', shrinkText: true } },
                              { text: fixed, options: { breakLine: false, autoFit: true, w: '100%', shrinkText: true } },
                            ]);
                        }
                        arrayOfTimes.push(currentTime);
                      }
                      else {
                        // ticket must have been reopened
                      }
                    }
                  });
                }
              }
            }
          }
        });

        // get DVS flying
        var dvs = [];
        var urlLoad = "https://intelshare.intelink.gov/sites/89cs/GNOC/_api/web/lists/getbytitle('Missions')/items?$top=5000&$filter=Created le '" + todayDateEnd + "' and Created ge '" + todayDate + "'&$orderby=DV%20asc";
        $.ajax({
          url: urlLoad,
          async: false,
          method: "GET",
          headers: {
            "Accept": "application/json;odata=verbose"
          },
          success: function (data) {
            var allResults = data.d.results;
            if (Number(allResults.length) > 0) {
              for (var i = 0; i < Number(allResults.length); i++) {
                if (!dvs.includes(allResults[i].DV) && allResults[i].DV != "GDSS" && allResults[i].DV != "DH")
                  dvs.push(allResults[i].DV);
              }
            }
          }
        });
        for (var i = 0; i < dvs.length; i++) {
          var currentPush = [];
          var urlLoad = "https://intelshare.intelink.gov/sites/89cs/GNOC/_api/web/lists/getbytitle('Missions')/items?$top=5000&$filter=Created le '" + todayDateEnd + "' and Created ge '" + todayDate + "' and DV eq '" + dvs[i] + "'&$orderby=Departure_Date%20asc";
          $.ajax({
            url: urlLoad,
            async: false,
            method: "GET",
            headers: {
              "Accept": "application/json;odata=verbose"
            },
            success: function (data) {
              var allResults = data.d.results;
              if (Number(allResults.length) > 0) {
                var dv = dvs[i];
                var ac = allResults[0].Tail_Number;
                var acType = "";
                var acLoad = "https://intelshare.intelink.gov/sites/89cs/GNOC/_api/web/lists/getbytitle('Tail_Numbers')/items?$top=5000&$filter=Tail_Number eq '" + ac + "'";
                // Get A/C Type
                $.ajax({
                  url: acLoad,
                  async: false,
                  method: "GET",
                  headers: {
                    "Accept": "application/json;odata=verbose"
                  },
                  success: function (data) {
                    var result = data.d.results;
                    if (allResults.length > 0) {
                      acType = result[0].Aircraft_Model;
                    }
                  }
                });
                if (acType != "")
                  ac = allResults[0].Tail_Number + "\n(" + acType + ")";
                var dvFill = false;
                for (var j = 0; j < Number(allResults.length); j++) {
                  var dep_location = allResults[j].Departure_Location;
                  var arr_location = allResults[j].Arrival_Location;
                  if (j == 0) {
                    if (i % 2 == 0) {
                      dvFill = true;
                      currentPush = [
                        { text: dv, options: { rowspan: allResults.length, breakLine: false, autoFit: true, w: '100%', bold: true, fill: 'd9d9d9' } },
                        { text: ac, options: { rowspan: allResults.length, breakLine: false, autoFit: true, w: '100%', align: 'center', fill: 'd9d9d9' } },
                        { text: dep_location, options: { breakLine: false, autoFit: true, w: '100%', fill: 'd9d9d9' } },
                        { text: arr_location, options: { breakLine: false, autoFit: true, w: '100%', fill: 'd9d9d9' } },
                      ];
                    }
                    else {
                      currentPush = [
                        { text: dv, options: { rowspan: allResults.length, breakLine: false, autoFit: true, w: '100%', bold: true } },
                        { text: ac, options: { rowspan: allResults.length, breakLine: false, autoFit: true, w: '100%', align: 'center' } },
                        { text: dep_location, options: { breakLine: false, autoFit: true, w: '100%' } },
                        { text: arr_location, options: { breakLine: false, autoFit: true, w: '100%' } },
                      ];
                    }

                  }
                  else {
                    if (dvFill) {
                      currentPush = [
                        { text: dep_location, options: { breakLine: false, autoFit: true, w: '100%', fill: 'd9d9d9' } },
                        { text: arr_location, options: { breakLine: false, autoFit: true, w: '100%', fill: 'd9d9d9' } },
                      ];
                    }
                    else {
                      currentPush = [
                        { text: dep_location, options: { breakLine: false, autoFit: true, w: '100%' } },
                        { text: arr_location, options: { breakLine: false, autoFit: true, w: '100%' } },
                      ];
                    }


                  }
                  dvsRows.push(currentPush);

                }
              }
            }
          });
        }



        $(document).on('click', '#genOpenPdf', function () {
          generatePDF("OPEN TICKETS", openRows);
        });
        $(document).on('click', '#genFixedPdf', function () {
          generatePDF("FIXED TICKETS", fixedRows);
        });
        $(document).on('click', '#genDvsPdf', function () {
          generatePDF("DVS FLYING", dvsRows);
        });
        $(document).on('click', '#genAllPdf', function () {
          generatePDF("ALL");
        });
      }
      feather.replace();
    });


    function splitTable(table) {
      var tableId = 1;
      var currentHeight = 0;
      var rows = $("#" + table + "_1 tr");

      for (var i = 0; i < rows.length; i++) {
        currentHeight += $(rows[i]).height();
        if (currentHeight >= 900) {
          // split to new table
          currentHeight = 0;
          tableId++;
          var currRow = $(rows[i]).remove().clone();
          $("#nav-openTickets").append("<hr><table class=\"table table-striped\" id=\"open_tickets_" + tableId + "\"><thead class=\"thead-light\"><tr><th style=\"width:200px;\">Date</th><th>DV</th><th>Mission</th><th>A/C</th><th style=\"width:200px;\">Ticket #</th><th>CCIR</th><th style=\"width:100px;\">DV Impact</th><th>Summary</th></tr></thead><tbody></tbody></table>");
          $("#" + table + "_" + tableId).append(currRow);
        }
        else if (tableId != 1) {
          var currRow = $(rows[i]).remove().clone();
          $("#" + table + "_" + tableId).append(currRow);
        }
      }
    }

    function convertDate(date, offset) {
      var convertDate = new Date(date);
      var month = convertDate.getUTCMonth();
      if (convertDate.getUTCMonth() + 1 < 10) {
        month = convertDate.getUTCMonth() + 1;
        month = "0" + month;
      }
      else
        month = convertDate.getUTCMonth() + 1;

      var date = convertDate.getDate();
      if (convertDate.getDate() < 10)
        date = "0" + convertDate.getDate();

      var minutes = convertDate.getUTCMinutes();
      if (convertDate.getUTCMinutes() < 10)
        minutes = "0" + convertDate.getUTCMinutes();

      var t = new Date();
      if (offset == 1) {
        var currentoffset = convertDate.getTimezoneOffset() * 60000;
        convertDate.setTime(convertDate.getTime() + currentoffset);
      }
      var hours = convertDate.getHours();

      if (convertDate.getHours() < 10)
        hours = "0" + hours;

      return dateString = month + "/" + date + "/" + convertDate.getUTCFullYear() + " " + hours + ":" + minutes + "Z";
    }

    var openRows = [[
      { text: "Date Opened", options: { bold: true, fontSize: 12, color: 'FFFFFF', fill: '4f81bd' } },
      { text: "DV", options: { bold: true, fontSize: 12, color: 'FFFFFF', fill: '4f81bd' } },
      { text: "Mission", options: { bold: true, fontSize: 12, color: 'FFFFFF', fill: '4f81bd' } },
      { text: "A/C", options: { bold: true, fontSize: 12, color: 'FFFFFF', fill: '4f81bd' } },
      { text: "Ticket #", options: { bold: true, fontSize: 12, color: 'FFFFFF', fill: '4f81bd' } },
      { text: "CCIR", options: { bold: true, fontSize: 12, color: 'FFFFFF', fill: '4f81bd' } },
      { text: "DV Impact", options: { bold: true, fontSize: 12, color: 'FFFFFF', fill: '4f81bd' } },
      { text: "Summary", options: { bold: true, fontSize: 12, color: 'FFFFFF', fill: '4f81bd' } },
    ]];
    var fixedRows = [[
      { text: "Date Opened", options: { bold: true, fontSize: 12, color: 'FFFFFF', fill: '4f81bd' } },
      { text: "DV", options: { bold: true, fontSize: 12, color: 'FFFFFF', fill: '4f81bd' } },
      { text: "Mission", options: { bold: true, fontSize: 12, color: 'FFFFFF', fill: '4f81bd' } },
      { text: "A/C", options: { bold: true, fontSize: 12, color: 'FFFFFF', fill: '4f81bd' } },
      { text: "Ticket #", options: { bold: true, fontSize: 12, color: 'FFFFFF', fill: '4f81bd' } },
      { text: "CCIR", options: { bold: true, fontSize: 12, color: 'FFFFFF', fill: '4f81bd' } },
      { text: "DV Impact", options: { bold: true, fontSize: 12, color: 'FFFFFF', fill: '4f81bd' } },
      { text: "Summary", options: { bold: true, fontSize: 12, color: 'FFFFFF', fill: '4f81bd' } },
      { text: "Fix", options: { bold: true, fontSize: 12, color: 'FFFFFF', fill: '4f81bd' } },
    ]];
    var dvsRows = [[
      { text: "DV", options: { bold: true, fontSize: 15, color: 'FFFFFF', fill: '4f81bd' } },
      { text: "A/C", options: { bold: true, fontSize: 15, color: 'FFFFFF', fill: '4f81bd' } },
      { text: "Departure", options: { bold: true, fontSize: 15, color: 'FFFFFF', fill: '4f81bd' } },
      { text: "Arrival", options: { bold: true, fontSize: 15, color: 'FFFFFF', fill: '4f81bd' } },
    ]];
    function generatePDF(title, rows) {
      var pptx = new PptxGenJS();
      pptx.layout = "LAYOUT_WIDE";
      pptx.author = "GSOC";
      pptx.suject = "TICKET REPORT";
      var titles = ["DVS FLYING", "OPEN TICKETS", "FIXED TICKETS"];
      var rowChoice = [dvsRows, openRows, fixedRows];
      if (title == "ALL") {
        for (var i = 0; i < titles.length; i++) {
          title = titles[i];
          rows = rowChoice[i];
          pptx.defineSlideMaster({
            title: "" + title + "_SLIDE",
            background: { color: "FFFFFF" },
            objects: [
              {
                text: {
                  text: "GSOC - " + title + "",
                  options: { x: 0, y: 0.2, w: "100%", h: 1.0, fontSize: 31, bold: true, align: 'center', color: '0C2D83', fontFace: 'Arial' }
                }
              },
              {
                text: {
                  text: "SAM FOX...PERFECTION is our Standard",
                  options: { x: 0, y: "90%", w: "100%", h: 1.0, fontSize: 31, align: 'center', bold: true, color: '0C2D83', fontFace: 'Arial' }
                }
              },
              { rect: { x: 0, y: 1.3, w: '100%', h: 0.05, fill: { color: '0C2D83' } } },
              { rect: { x: 0, y: 7.0, w: '100%', h: 0.05, fill: { color: '0C2D83' } } },
              { image: { x: 0.7, y: 0.2, w: 1.0, h: 1.0, path: "./img/89cs.png" } },
              { image: { x: 11.8, y: 0.2, w: 1.0, h: 1.0, path: "./img/samfox.jpg" } },
            ],
            slideNumber: { x: 0.3, y: "95%" },
          });
          var slide = pptx.addSlide({ masterName: "" + title + "_SLIDE" });
          if (title == "OPEN TICKETS") {
            var tabOpts = { x: '1%', y: 1.5, h: 4.3, fill: 'FFFFFF', fontSize: 10, color: '000000', autoPage: true, colW: [1.5, 1.0, 1.0, .8, 1.5, 0.5, 0.8, 6.0], rowH: [0.2], valign: "middle", autoPageRepeatHeader: true, newSlideStartY: 1.5, border: { type: 'solid' } };
            slide.addTable(rows, tabOpts);
          }
          if (title == "FIXED TICKETS") {
            var tabOpts = { x: '1%', y: 1.5, h: 4.3, fill: 'FFFFFF', fontSize: 10, color: '000000', autoPage: true, colW: [1.5, 1.0, 1.0, .8, 1.5, 0.5, 0.8, 3.0, 3.0], rowH: [0.2], valign: "middle", autoPageRepeatHeader: true, newSlideStartY: 1.5, border: { type: 'solid' } };
            slide.addTable(rows, tabOpts);
          }
          if (title == "DVS FLYING") {
            var tabOpts = { x: '2.5%', y: 1.5, h: 4.3, fill: 'FFFFFF', fontSize: 12, color: '000000', autoPage: true, colW: [2.5, 2.0, 4.0, 4.0], rowH: [0.2], valign: "middle", autoPageRepeatHeader: true, newSlideStartY: 1.5, border: { type: 'solid' } };
            slide.addTable(rows, tabOpts);
          }
        }
      }
      else {
        pptx.defineSlideMaster({
          title: "" + title + "_SLIDE",
          background: { color: "FFFFFF" },
          objects: [
            {
              text: {
                text: "GSOC - " + title + "",
                options: { x: 4, y: 0.2, w: "70%", h: 1.0, fontSize: 31, bold: true, color: '0C2D83', fontFace: 'Arial' }
              }
            },
            {
              text: {
                text: "SAM FOX...PERFECTION is our Standard",
                options: { x: 2.5, y: "90%", w: "70%", h: 1.0, fontSize: 31, bold: true, color: '0C2D83', fontFace: 'Arial' }
              }
            },
            { rect: { x: 0, y: 1.3, w: '100%', h: 0.05, fill: { color: '0C2D83' } } },
            { rect: { x: 0, y: 7.0, w: '100%', h: 0.05, fill: { color: '0C2D83' } } },
            { image: { x: 0.7, y: 0.2, w: 1.0, h: 1.0, path: "./img/89cs.png" } },
            { image: { x: 11.8, y: 0.2, w: 1.0, h: 1.0, path: "./img/samfox.jpg" } },
          ],
          slideNumber: { x: 0.3, y: "95%" },
        });


        var slide = pptx.addSlide({ masterName: "" + title + "_SLIDE" });
        if (title == "OPEN TICKETS") {
          var tabOpts = { x: '1%', y: 1.5, h: 4.3, fill: 'FFFFFF', fontSize: 10, color: '000000', autoPage: true, colW: [1.5, 1.0, 1.0, .8, 1.5, 0.5, 0.8, 6.0], rowH: [0.2], valign: "middle", autoPageRepeatHeader: true, newSlideStartY: 1.5, border: { type: 'solid' } };
          slide.addTable(rows, tabOpts);
        }
        if (title == "FIXED TICKETS") {
          var tabOpts = { x: '1%', y: 1.5, h: 4.3, fill: 'FFFFFF', fontSize: 10, color: '000000', autoPage: true, colW: [1.5, 1.0, 1.0, .8, 1.5, 0.5, 0.8, 3.0, 3.0], rowH: [0.2], valign: "middle", autoPageRepeatHeader: true, newSlideStartY: 1.5, border: { type: 'solid' } };
          slide.addTable(rows, tabOpts);
        }
        if (title == "DVS FLYING") {
          var tabOpts = { x: '2.5%', y: 1.5, h: 4.3, fill: 'FFFFFF', fontSize: 12, color: '000000', autoPage: true, colW: [2.5, 2.0, 4.0, 4.0], rowH: [0.2], valign: "middle", autoPageRepeatHeader: true, newSlideStartY: 1.5, border: { type: 'solid' } };
          slide.addTable(rows, tabOpts);
        }
      }
      pptx.writeFile("Morning Slides");
    }
  </script>
</head>

<body>
  <nav class="navbar navbar-dark bg-dark flex-md-nowrap p-0">
    <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="./index.html">
      <svg width="2em" height="2em" viewBox="0 0 16 16" class="bi bi-broadcast-pin" fill="currentColor"
        xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd"
          d="M3.05 3.05a7 7 0 0 0 0 9.9.5.5 0 0 1-.707.707 8 8 0 0 1 0-11.314.5.5 0 0 1 .707.707zm2.122 2.122a4 4 0 0 0 0 5.656.5.5 0 0 1-.708.708 5 5 0 0 1 0-7.072.5.5 0 0 1 .708.708zm5.656-.708a.5.5 0 0 1 .708 0 5 5 0 0 1 0 7.072.5.5 0 1 1-.708-.708 4 4 0 0 0 0-5.656.5.5 0 0 1 0-.708zm2.122-2.12a.5.5 0 0 1 .707 0 8 8 0 0 1 0 11.313.5.5 0 0 1-.707-.707 7 7 0 0 0 0-9.9.5.5 0 0 1 0-.707zM6 8a2 2 0 1 1 2.5 1.937V15.5a.5.5 0 0 1-1 0V9.937A2 2 0 0 1 6 8z" />
      </svg> &nbsp;
      <b>GNOC DV Dashboard</b>
    </a>
  </nav>
  <div class="container-fluid">
    <div class="row">
      <nav class="col-md-2 d-none d-md-block bg-light sidebar">
        <div class="sidebar-sticky">
          <ul class="nav flex-column">
            <li class="nav-item" id="dashboard_div">
              <a class="nav-link" href="./index.html">
                <span data-feather="home"></span>
                Dashboard
              </a>
            </li>
            <li class="nav-item" id="flight_schedule_div">
              <a class="nav-link" href="./flightschedule.html">
                <span data-feather="clock"></span>
                Flight Schedule
              </a>
            </li>
            <li class="nav-item" id="contact_list_div">
              <a class="nav-link" href="./contactList.html">
                <span data-feather="phone"></span>
                Contact List
              </a>
            </li>
          </ul>
          <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted"
            id="tickets_header_div">
            <span>Trouble Tickets</span>
            <a class="d-flex align-items-center text-muted" href="./ticketSettings.html" id="ticket_settings_div">
              <span data-feather="settings"></span>
            </a>
          </h6>
          <ul class="nav flex-column mb-2">
            <li class="nav-item" id="create_tts_div">
              <a class="nav-link" href="./createTTS.html">
                <span data-feather="file"></span>
                Create a TTS
              </a>
            </li>
            <li class="nav-item" id="create_master_tts_div">
              <a class="nav-link" href="./createMasterTTS.html">
                <span data-feather="file"></span>
                Create a Master TTS
              </a>
            </li>
            <li class="nav-item" id="view_tickets_div">
              <a class="nav-link" href="./viewTickets.html">
                <span data-feather="file-text"></span>
                View Tickets
              </a>
            </li>
            <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted"
              id="flight_tickets_header_div">
              <span>Flight Tickets</span>
              <a class="d-flex align-items-center text-muted" href="./createFlightTicket.html"
                id="create_flight_ticket_icon_div">
                <span data-feather="plus-circle"></span>
              </a>
            </h6>
            <ul class="nav flex-column mb-2">
              <li class="nav-item" id="create_flight_ticket_div">
                <a class="nav-link" href="./createFlightTicket.html">
                  <span data-feather="file"></span>
                  Create a Flight Ticket
                </a>
              </li>
              <li class="nav-item" id="view_flight_tickets_div">
                <a class="nav-link" href="./viewFlightTickets.html">
                  <span data-feather="file-text"></span>
                  View Flight Tickets
                </a>
              </li>
              <li class="nav-item" id="view_missions_div">
                <a class="nav-link" href="./viewMissions.html">
                  <span data-feather="file-text"></span>
                  View Missions
                </a>
              </li>
            </ul>
            <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted"
              id="ccir_header_div">
              <span>CCIRs</span>
              <a class="d-flex align-items-center text-muted" href="./createCCIR.html" id="add_a_ccir_icon_div">
                <span data-feather="plus-circle"></span>
              </a>
            </h6>
            <ul class="nav flex-column mb-2">
              <li class="nav-item" id="add_a_ccir_div">
                <a class="nav-link" href="./createCCIR.html">
                  <span data-feather="file"></span>
                  Add a CCIR
                </a>
              </li>
              <li class="nav-item" id="view_ccirs_div">
                <a class="nav-link" href="./viewCCIRS.html">
                  <span data-feather="file-text"></span>
                  View CCIRs
                </a>
              </li>
            </ul>
            <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted"
              id="reports_header_div">
              <span>Reports</span>
            </h6>
            <ul class="nav flex-column mb-2">
              <li class="nav-item" id="24_hour_report_div">
                <a class="nav-link" href="./ticketReport.html">
                  <span data-feather="file-text"></span>
                  24 Hour Ticket Report <span class="sr-only">(current)</span>
                </a>
              </li>
              <li class="nav-item" id="weekend_report_div">
                <a class="nav-link" href="./weekendTicketReport.html">
                  <span data-feather="file-text"></span>
                  Weekend Ticket Report
                </a>
              </li>
              <li class="nav-item" id="morning_slides_div">
                <a class="nav-link active" href="./morningSlides.html">
                  <span data-feather="file-text"></span>
                  Morning Slides <span class="sr-only">(current)</span>
                </a>
              </li>
              <li class="nav-item" id="personnel_stats_div">
                <a class="nav-link" href="./personnelStats.html">
                  <span data-feather="file-text"></span>
                  Personnel Stats
                </a>
              </li>
              <li class="nav-item" id="monthly_metrics_div">
                <a class="nav-link" href="./metrics.html">
                  <span data-feather="file-text"></span>
                  Monthly Metrics
                </a>
              </li>
              <li class="nav-item" id="permissions_div">
                <a class="nav-link" href="./permissions.html">
                  <span data-feather="file-text"></span>
                  Permissions
                </a>
              </li>
            </ul>
        </div>
      </nav>
      <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4" id="export">
        <div
          class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
          <h1 id="header">Morning Slides <span id="start_date"></span> - <span id="end_date"></span></h1>
        </div>
        <div class="col-md-12">
          <div class="alert alert-danger" role="alert">
            Please download the powerpoint <b>TWICE</b>. The first one may not come out correctly.<br>This is a known
            bug and is being worked on.
          </div>
          <div class="card">
            <div class="card-header">
              Download Options
            </div>
            <div class="card-body">
              <button type="button" id="genAllPdf" class="btn btn-primary">Download Powerpoint</button>
              &nbsp;
              <button type="button" id="genDvsPdf" class="btn btn-primary">Download DVS Flying Powerpoint</button>
              &nbsp;
              <button type="button" id="genOpenPdf" class="btn btn-primary">Download Open Tickets Powerpoint</button>
              &nbsp;
              <button type="button" id="genFixedPdf" class="btn btn-primary">Download Fixed Tickets Powerpoint</button>
              &nbsp;
            </div>
          </div>
          <br>
          <div class="card">
            <div class="card-header">
              Data for Slides (Ignore)
            </div>
            <div class="card-body">
              <nav>
                <div class="nav nav-tabs" id="nav-tab" role="tablist">
                  <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-home" role="tab"
                    aria-controls="nav-home" aria-selected="true">DVS Flying</a>
                  <a class="nav-item nav-link" id="nav-openTickets-tab" data-toggle="tab" href="#nav-openTickets"
                    role="tab" aria-controls="nav-openTickets" aria-selected="false">Open Tickets</a>
                  <a class="nav-item nav-link" id="nav-fixedTickets-tab" data-toggle="tab" href="#nav-fixedTickets"
                    role="tab" aria-controls="nav-fixedTickets" aria-selected="false">Fixed Tickets</a>
                </div>
              </nav>
              <div class="tab-content" id="nav-tabContent">
                <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
                  <table class="table table-striped" id="dvs_flying_1">
                    <thead class="thead-light" id="dvs_flying_head_1">
                      <tr>
                        <th scope="col">DV</th>
                        <th scope="col">A/C</th>
                        <th scope="col">DEP</th>
                        <th scope="col">ARR</th>
                      </tr>
                    </thead>
                    <tbody>
                    </tbody>
                  </table>
                </div>
                <div class="tab-pane fade" id="nav-openTickets" role="tabpanel" aria-labelledby="nav-openTickets-tab">
                  <table class="table table-striped" id="open_tickets_1">
                    <thead class="thead-light" id="open_tickets_head_1">
                      <tr>
                        <th scope="col" style="width:200px;">Date</th>
                        <th scope="col">DV</th>
                        <th scope="col">Mission</th>
                        <th scope="col">A/C</th>
                        <th scope="col" style="width:200px;">Ticket #</th>
                        <th scope="col">CCIR</th>
                        <th scope="col" style="width:100px;">DV Impact</th>
                        <th scope="col">Summary</th>
                      </tr>
                    </thead>
                    <tbody>
                    </tbody>
                  </table>
                </div>
                <div class="tab-pane fade" id="nav-fixedTickets" role="tabpanel" aria-labelledby="nav-fixedTickets-tab">
                  <table class="table table-striped" id="fixed_tickets_1">
                    <thead class="thead-light" id="fixed_tickets_head_1">
                      <tr>
                        <th scope="col" style="width:200px;">Date Opened</th>
                        <th scope="col">DV</th>
                        <th scope="col">Mission</th>
                        <th scope="col">A/C</th>
                        <th scope="col" style="width:200px;">Ticket #</th>
                        <th scope="col">CCIR</th>
                        <th scope="col" style="width:100px;">DV Impact</th>
                        <th scope="col">Summary</th>
                        <th scope="col">Fix</th>
                      </tr>
                    </thead>
                    <tbody>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
      <br />
      <footer class="py-4 col-md-2 bg-light" style="box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1);">
        <div class="container-fluid">
          <div class="d-flex align-items-center justify-content-between small">
            <div class="text-muted">GNOC DV Dashboard - maintained by GNOC @ JBA<br />
              <a href="mailto:89CS.SCOV.VIP.COMM@us.af.mil">89CS.SCOV.VIP.COMM@us.af.mil</a>
            </div>
          </div>
        </div>
      </footer>
    </div>
  </div>
</body>

</html>